(()=>{"use strict";function t(t,e){let s=t.length;Array.isArray(t[0])||(t=[t]),Array.isArray(e[0])||(e=e.map((t=>[t])));let r=e[0].length,a=e[0].map(((t,s)=>e.map((t=>t[s])))),o=t.map((t=>a.map((e=>Array.isArray(t)?t.reduce(((t,s,r)=>t+s*(e[r]||0)),0):e.reduce(((e,s)=>e+s*t),0)))));return 1===s&&(o=o[0]),1===r?o.map((t=>t[0])):o}function e(t){return"string"===s(t)}function s(t){return(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function r(t,...e){for(let s of e)if(s){let e=Object.getOwnPropertyDescriptors(s);Object.defineProperties(t,e)}return t}function a(t,e,s){let r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,r)}function o(t,e,s=[0,1]){e=+e;let r=((s[1]||s[0]||1)+"").length,a=Math.max(0,e+1-r);return+t.toFixed(a)}function i(t){if(t.indexOf(".")>0){let[e,s]=t.split("."),r=Color.space(e);if(!(s in r.coords))throw new ReferenceError(`Color space "${r.name}" has no "${s}" coordinate.`);return[r,s]}}function n(t,e,s){let r=e.split("."),a=r.pop();if(t=r.reduceRight(((t,e)=>t&&t[e]),t))return void 0===s?t[a]:t[a]=s}var c=Object.freeze({__proto__:null,isString:e,type:s,extend:r,copyDescriptor:a,capitalize:function(t){return t?t[0].toUpperCase()+t.slice(1):t},toPrecision:o,parseCoord:i,value:n,multiplyMatrices:t});const h="undefined"!=typeof document;class l{constructor(...t){let s,r;if(t[0]&&"object"==typeof t[0]&&(t[0].space||t[0].spaceId)&&t[0].coords)r=t[0];else if(e(t[0])){if(h&&0===t[0].indexOf("--")){let t=arguments[1]&&1===arguments[1].nodeType?arguments[1]:document.documentElement;s=getComputedStyle(t).getPropertyValue(arguments[0])}else 1===t.length&&(s=t[0]);s&&(r=l.parse(s))}if(r)"spaceId"in r?this.spaceId=r.spaceId:this.space=r.space,this.coords=r.coords.slice(),this.alpha=r.alpha;else{let e,s,r;Array.isArray(t[0])?[e,s,r]=["sRGB",...t]:[e,s,r]=t,this.spaceId=e||"sRGB",this.coords=s?s.slice():[0,0,0],this.alpha=r}this.alpha=this.alpha<1?this.alpha:1;for(let t=0;t<this.coords.length;t++)"NaN"===this.coords[t]&&(this.coords[t]=NaN)}get space(){return l.spaces[this.spaceId]}set space(t){return this.spaceId=t}get spaceId(){return this._spaceId}set spaceId(t){let e=l.space(t);if(t=e.id,this.space&&e&&this.space!==e){this.coords=this[t];for(let t in this.space.instance)this.hasOwnProperty(t)&&delete this[t]}this._spaceId=t,r(this,this.space.instance)}get white(){return this.space.white||l.whites.D50}set(t,e){if(1===arguments.length&&"object"===s(arguments[0])){let t=arguments[0];for(let e in t)this.set(e,t[e])}else if("function"==typeof e){let s=n(this,t);n(this,t,e.call(this,s))}else n(this,t,e);return this}lighten(t=.25){let e=new l(this),s=e.lightness;return e.lightness=s*(1+t),e}darken(t=.25){let e=new l(this),s=e.lightness;return e.lightness=s*(1-t),e}distance(t,e="lab"){t=l.get(t);let s=this[(e=l.space(e)).id],r=t[e.id];return Math.sqrt(s.reduce(((t,e,s)=>isNaN(e)||isNaN(r[s])?t:t+(r[s]-e)**2),0))}deltaE(t,s={}){e(s)&&(s={method:s});let{method:r=l.defaults.deltaE,...a}=s;return t=l.get(t),this["deltaE"+r]?this["deltaE"+r](t,a):this.deltaE76(t)}deltaE76(t){return this.distance(t,"lab")}get luminance(){return this.xyz.Y}set luminance(t){this.xyz.Y=t}contrast(t){t=l.get(t);let e=this.luminance,s=t.luminance;return s>e&&([e,s]=[s,e]),(e+.05)/(s+.05)}get uv(){let[t,e,s]=this.xyz,r=t+15*e+3*s;return[4*t/r,9*e/r]}get xy(){let[t,e,s]=this.xyz,r=t+e+s;return[t/r,e/r]}getCoords({inGamut:t,precision:e=l.defaults.precision}={}){let s=this.coords;if(t&&!this.inGamut()&&(s=this.toGamut(!0===t?void 0:t).coords),null!=e){let t=this.space.coords?Object.values(this.space.coords):[];s=s.map(((s,r)=>o(s,e,t[r])))}return s}inGamut(t=this.space,e){return t=l.space(t),l.inGamut(t,this[t.id],e)}static inGamut(t,e,{epsilon:s=75e-6}={}){if((t=l.space(t)).inGamut)return t.inGamut(e);{if(!t.coords)return!0;let r=Object.values(t.coords);return e.every(((t,e)=>{if(Number.isNaN(t))return!0;let[a,o]=r[e];return(void 0===a||t>=a-s)&&(void 0===o||t<=o+s)}))}}toGamut({method:t=l.defaults.gamutMapping,space:s=this.space,inPlace:r}={}){if(e(arguments[0])&&(s=arguments[0]),s=l.space(s),this.inGamut(s,{epsilon:0}))return this;let a=this.to(s);if(t.indexOf(".")>0&&!this.inGamut(s)){let e=a.toGamut({method:"clip",space:s}),r=this.deltaE(e,{method:"2000"});if(this.deltaE(e,{method:"2000"})>2.3){let[e,o]=i(t),n=a.to(e),c=.001,h=e.coords[o][0],l=n[o],p=a.deltaE(n,{method:"2000"});for(;l-h>c&&p<r;){let t=n.toGamut({space:s,method:"clip"}),e=n.deltaE(t,{method:"2000"});if(p=a.deltaE(n,{method:"2000"}),e-2<c)h=n[o];else{if(Math.abs(e-2)<c)break;l=n[o]}n[o]=(l+h)/2}a=n.to(s)}else a=e}if("clip"===t||!a.inGamut(s,{epsilon:0})){let t=Object.values(s.coords);a.coords=a.coords.map(((e,s)=>{let[r,a]=t[s];return void 0!==r&&(e=Math.max(r,e)),void 0!==a&&(e=Math.min(e,a)),e}))}return s.id!==this.spaceId&&(a=a.to(this.space)),r?(this.coords=a.coords,this):a}clone(){return new l(this.spaceId,this.coords,this.alpha)}to(t,{inGamut:e}={}){let s=(t=l.space(t)).id,r=new l(s,this[s],this.alpha);return e&&r.toGamut({inPlace:!0}),r}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}toString({precision:t=l.defaults.precision,format:s,commas:r,inGamut:a,name:o="color",fallback:i}={}){let n=this.alpha<1?` ${r?",":"/"} ${this.alpha}`:"",c=this.getCoords({inGamut:a,precision:t});if(c=c.map((t=>t||0)),e(s)&&"%"===s){let e=t;(!Number.isInteger(t)||t>21)&&(e=21),s=t=>t.toLocaleString("en-US",{style:"percent",maximumSignificantDigits:e})}"function"==typeof s&&(c=c.map(s));let p=[...c];"color"===o&&p.unshift(this.space?this.space.cssId||this.space.id:"XYZ");let d=`${o}(${p.join(r?", ":" ")}${n})`;if(i){if(!h||!self.CSS||CSS.supports("color",d))return d=new String(d),d.color=this,d;let e=Array.isArray(i)?i.slice():l.defaults.fallbackSpaces;for(let s,r=0;s=e[r];r++)if(l.spaces[s]){let a=this.to(s);if(d=a.toString({precision:t}),CSS.supports("color",d))return d=new String(d),d.color=a,d;e===l.defaults.fallbackSpaces&&(e.splice(r,1),r--)}let s=this.to("srgb");d=new String(s.toString({commas:!0})),d.color=s}return d}equals(t){return t=l.get(t),this.spaceId===t.spaceId&&this.alpha===t.alpha&&this.coords.every(((e,s)=>e===t.coords[s]))}static chromaticAdaptation(e,s,r,a={}){if((e=e||l.whites.D50)===(s=s||l.whites.D50))return r;let o={W1:e,W2:s,XYZ:r,options:a};if(l.hooks.run("chromatic-adaptation-start",o),o.M||(o.W1===l.whites.D65&&o.W2===l.whites.D50?o.M=[[1.0478112,.0228866,-.050127],[.0295424,.9904844,-.0170491],[-.0092345,.0150436,.7521316]]:o.W1===l.whites.D50&&o.W2===l.whites.D65&&(o.M=[[.9555766,-.0230393,.0631636],[-.0282895,1.0099416,.0210077],[.0122982,-.020483,1.3299098]])),l.hooks.run("chromatic-adaptation-end",o),o.M)return t(o.M,o.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}static parse(t){let e={str:t};if(l.hooks.run("parse-start",e),e.color)return e.color;if(e.parsed=l.parseFunction(e.str),l.hooks.run("parse-function-start",e),e.color)return e.color;for(let t of Object.values(l.spaces))if(t.parse){let s=t.parse(e.str,e.parsed);if(s)return s}let s=e.parsed&&e.parsed.name;if(!/^color|^rgb/.test(s)&&h&&document.head){let r=document.head.style.color;if(document.head.style.color="",document.head.style.color=t,document.head.style.color!==r){let a=getComputedStyle(document.head).color;document.head.style.color=r,a&&(t=a,e.parsed=l.parseFunction(a),s=e.parsed.name)}}if(e.parsed){if("rgb"===s||"rgba"===s){let t=e.parsed.args.map(((t,e)=>e<3&&!t.percentage?t/255:+t));return{spaceId:"srgb",coords:t.slice(0,3),alpha:t[3]}}if("color"===s){let t=e.parsed.args.shift().toLowerCase(),s=Object.values(l.spaces).find((e=>(e.cssId||e.id)===t));if(s){let t=Object.keys(s.coords).length,r=e.parsed.rawArgs.indexOf("/")>0?e.parsed.args.pop():1,a=Array(t).fill(0);return a.forEach(((t,s)=>a[s]=e.parsed.args[s]||0)),{spaceId:s.id,coords:a,alpha:r}}throw new TypeError(`Color space ${t} not found. Missing a plugin?`)}}throw new TypeError(`Could not parse ${t} as a color. Missing a plugin?`)}static parseFunction(t){if(!t)return;t=t.trim();const e=/^-?[\d.]+$/;let s=t.match(/^([a-z]+)\((.+?)\)$/i);if(s){let t=s[2].match(/([-\w.]+(?:%|deg)?)/g);return t=t.map((t=>{if(/%$/.test(t)){let e=new Number(+t.slice(0,-1)/100);return e.percentage=!0,e}if(/deg$/.test(t)){let e=new Number(+t.slice(0,-3));return e.deg=!0,e}return e.test(t)?+t:t})),{name:s[1].toLowerCase(),rawName:s[1],rawArgs:s[2],args:t}}}static convert(t,e,s){if((e=l.space(e))===(s=l.space(s)))return t;t=t.map((t=>Number.isNaN(t)?0:t));let r=e.id,a=s.id;if(s.from&&s.from[r])return s.from[r](t);if(e.to&&e.to[a])return e.to[a](t);let o=e.toXYZ(t);return s.white!==e.white&&(o=l.chromaticAdaptation(e.white,s.white,o)),s.fromXYZ(o)}static get(t,...e){return t instanceof l?t:new l(t,...e)}static space(t){let e=s(t);if("string"===e){let e=l.spaces[t.toLowerCase()];if(!e)throw new TypeError(`No color space found with id = "${t}"`);return e}if(t&&"object"===e)return t;throw new TypeError(`${t} is not a valid color space`)}static defineSpace({id:t,inherits:e}){let s=l.spaces[t]=arguments[0];if(e){const t=["id","parse","instance","properties"];let r=l.spaces[e];for(let e in r)t.includes(e)||e in s||a(s,r,e)}let o=s.coords;if(s.properties&&r(l.prototype,s.properties),!s.fromXYZ&&!s.toXYZ){let t;if(s.from&&s.to){let e=new Set(Object.keys(s.from)),r=new Set(Object.keys(s.to)),a=[...e].filter((t=>{if(r.has(t)){let e=l.spaces[t];return e&&e.fromXYZ&&e.toXYZ}}));a.length>0&&(t=l.spaces[a[0]])}if(!t)throw new ReferenceError(`No connection space found for ${s.name}.`);Object.assign(s,{fromXYZ(e){let s=t.fromXYZ(e);return this.from[t.id](s)},toXYZ(e){let s=this.to[t.id](e);return t.toXYZ(s)}})}let i=Object.keys(o);return Object.defineProperty(l.prototype,t,{get(){let e=l.convert(this.coords,this.spaceId,t);return self.Proxy?new Proxy(e,{has:(t,e)=>i.includes(e)||Reflect.has(t,e),get:(t,e,s)=>{let r=i.indexOf(e);return r>-1?t[r]:Reflect.get(t,e,s)},set:(e,s,r,a)=>{let o=i.indexOf(s);return s>-1&&(o=s),o>-1?(e[o]=r,this.coords=l.convert(e,t,this.spaceId),!0):Reflect.set(e,s,r,a)}}):e},set(e){this.coords=l.convert(e,t,this.spaceId)},configurable:!0,enumerable:!0}),s}static defineShortcut(t,e=l.prototype,s){s&&(l.shortcuts[t]=s),Object.defineProperty(e,t,{get(){return n(this,l.shortcuts[t])},set(e){return n(this,l.shortcuts[t],e)},configurable:!0,enumerable:!0})}static statify(t=[]){t=t||Object.getOwnPropertyNames(l.prototype);for(let t of Object.getOwnPropertyNames(l.prototype)){let e=Object.getOwnPropertyDescriptor(l.prototype,t);e.get||e.set||"function"!=typeof e.value||t in l||(l[t]=function(e,...s){return(e=l.get(e))[t](...s)})}}}Object.assign(l,{util:c,hooks:new class{add(t,e,s){if("string"==typeof arguments[0])(Array.isArray(t)?t:[t]).forEach((function(t){this[t]=this[t]||[],e&&this[t][s?"unshift":"push"](e)}),this);else for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1])}run(t,e){this[t]=this[t]||[],this[t].forEach((function(t){t.call(e&&e.context?e.context:e,e)}))}},whites:{D50:[.96422,1,.82521],D65:[.95047,1,1.08883]},spaces:{},shortcuts:{lightness:"lch.lightness",chroma:"lch.chroma",hue:"lch.hue"},defaults:{gamutMapping:"lch.chroma",precision:5,deltaE:"76",fallbackSpaces:["p3","srgb"]}}),l.defineSpace({id:"xyz",name:"XYZ",coords:{X:[],Y:[],Z:[]},white:l.whites.D50,inGamut:t=>!0,toXYZ:t=>t,fromXYZ:t=>t});for(let t in l.shortcuts)l.defineShortcut(t);l.statify(),l.defineSpace({id:"lab",name:"Lab",coords:{L:[0,100],a:[-100,100],b:[-100,100]},inGamut:t=>!0,white:l.whites.D50,ε:216/24389,κ:24389/27,fromXYZ(t){const{κ:e,ε:s,white:r}=this;let a=t.map(((t,e)=>t/r[e])),o=a.map((t=>t>s?Math.cbrt(t):(e*t+16)/116));return[116*o[1]-16,500*(o[0]-o[1]),200*(o[1]-o[2])]},toXYZ(t){const{κ:e,ε:s,white:r}=this;let a=[];return a[1]=(t[0]+16)/116,a[0]=t[1]/500+a[1],a[2]=a[1]-t[2]/200,[Math.pow(a[0],3)>s?Math.pow(a[0],3):(116*a[0]-16)/e,t[0]>e*s?Math.pow((t[0]+16)/116,3):t[0]/e,Math.pow(a[2],3)>s?Math.pow(a[2],3):(116*a[2]-16)/e].map(((t,e)=>t*r[e]))},parse(t,e=l.parseFunction(t)){if(e&&"lab"===e.name){let t=e.args[0];return t.percentage&&(e.args[0]=100*t),{spaceId:"lab",coords:e.args.slice(0,3),alpha:e.args.slice(3)[0]}}},instance:{toString({format:t,...e}={}){return t||(t=(t,e)=>0===e?t+"%":t),l.prototype.toString.call(this,{name:"lab",format:t,...e})}}});const p=[0,360];function d(t){return(t%360+360)%360}p.isAngle=!0,l.defineSpace({id:"lch",name:"LCH",coords:{lightness:[0,100],chroma:[0,150],hue:p},inGamut:t=>!0,white:l.whites.D50,from:{lab(t){let e,[s,r,a]=t;const o=5e-4;return e=Math.abs(r)<o&&Math.abs(a)<o?NaN:180*Math.atan2(a,r)/Math.PI,[s,Math.sqrt(r**2+a**2),d(e)]}},to:{lab(t){let[e,s,r]=t;return s<0&&(s=0),isNaN(r)&&(r=0),[e,s*Math.cos(r*Math.PI/180),s*Math.sin(r*Math.PI/180)]}},parse(t,e=l.parseFunction(t)){if(e&&"lch"===e.name){let t=e.args[0];return t.percentage&&(e.args[0]=100*t),{spaceId:"lch",coords:e.args.slice(0,3),alpha:e.args.slice(3)[0]}}},instance:{toString({format:t,...e}={}){return t||(t=(t,e)=>0===e?t+"%":t),l.prototype.toString.call(this,{name:"lch",format:t,...e})}}}),l.defineSpace({id:"srgb",name:"sRGB",coords:{red:[0,1],green:[0,1],blue:[0,1]},white:l.whites.D65,toLinear:t=>t.map((function(t){return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)})),toGamma:t=>t.map((function(t){return t>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t})),toXYZ_M:[[.4124564,.3575761,.1804375],[.2126729,.7151522,.072175],[.0193339,.119192,.9503041]],fromXYZ_M:[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],toXYZ(e){return e=this.toLinear(e),t(this.toXYZ_M,e)},fromXYZ(e){return this.toGamma(t(this.fromXYZ_M,e))},properties:{toHex({alpha:t=!0,collapse:e=!0}={}){let s=this.to("srgb",{inGamut:!0}).coords;this.alpha<1&&t&&s.push(this.alpha),s=s.map((t=>Math.round(255*t)));let r=e&&s.every((t=>t%17==0));return"#"+s.map((t=>r?(t/17).toString(16):t.toString(16).padStart(2,"0"))).join("")},get hex(){return this.toHex()}},instance:{toString({inGamut:t=!0,commas:e,format:s="%",...r}={}){if(255===s)s=t=>255*t;else if("hex"===s)return this.toHex(arguments[0]);return l.prototype.toString.call(this,{inGamut:t,commas:e,format:s,name:"rgb"+(e&&this.alpha<1?"a":""),...r})}},parseHex(t){t.length<=5&&(t=t.replace(/[a-f0-9]/gi,"$&$&"));let e=[];return t.replace(/[a-f0-9]{2}/gi,(t=>{e.push(parseInt(t,16)/255)})),{spaceId:"srgb",coords:e.slice(0,3),alpha:e.slice(3)[0]}}}),l.hooks.add("parse-start",(t=>{let e=t.str;/^#([a-f0-9]{3,4}){1,2}$/i.test(e)&&(t.color=l.spaces.srgb.parseHex(e))})),l.defineSpace({id:"hsl",name:"HSL",coords:{hue:p,saturation:[0,100],lightness:[0,100]},inGamut(t){let e=this.to.srgb(t);return l.inGamut("srgb",e)},white:l.whites.D65,from:{srgb(t){t=t.map((t=>100*t));let e=Math.max.apply(Math,t),s=Math.min.apply(Math,t),[r,a,o]=t,[i,n,c]=[NaN,0,(s+e)/2],h=e-s;if(0!==h){switch(n=100*h/(100-Math.abs(2*c-100)),e){case r:i=(a-o)/h+(a<o?6:0);break;case a:i=(o-r)/h+2;break;case o:i=(r-a)/h+4}i*=60}return[i,n,c]}},to:{srgb(t){let[e,s,r]=t;function a(t){let a=(t+e/30)%12,o=s*Math.min(r,1-r);return r-o*Math.max(-1,Math.min(a-3,9-a,1))}return e%=360,e<0&&(e+=360),s/=100,r/=100,[a(0),a(8),a(4)]}},parse(t,e=l.parseFunction(t)){if(e&&/^hsla?$/.test(e.name)){let t=e.args;return t[1]*=100,t[2]*=100,{spaceId:"hsl",coords:t.slice(0,3),alpha:t[3]}}},instance:{toString({precision:t,commas:e,format:s,inGamut:r,...a}={}){return s||(s=(t,e)=>e>0?t+"%":t),l.prototype.toString.call(this,{inGamut:!0,commas:e,format:s,name:"hsl"+(e&&this.alpha<1?"a":""),...a})}}}),l.defineSpace({id:"hwb",name:"HWB",coords:{hue:p,whiteness:[0,100],blackness:[0,100]},inGamut(t){let e=this.to.srgb(t);return l.inGamut("srgb",e)},white:l.whites.D65,from:{srgb(t){let e=l.spaces.hsl.from.srgb(t)[0],s=Math.min(...t),r=1-Math.max(...t);return s*=100,r*=100,[e,s,r]},hsv(t){let[e,s,r]=t;return[e,r*(100-s)/100,100-r]},hsl(t){let e=l.spaces.hsv.from.hsl(t);return this.hsv(e)}},to:{srgb(t){let[e,s,r]=t;s/=100,r/=100;let a=s+r;if(a>=1){let t=s/a;return[t,t,t]}let o=l.spaces.hsl.to.srgb([e,100,50]);for(var i=0;i<3;i++)o[i]*=1-s-r,o[i]+=s;return o},hsv(t){let[e,s,r]=t;s/=100,r/=100;let a=s+r;return a>=1?[e,0,s/a]:[e,100-100*s/(100-r),100*(1-r)]},hsl(t){let e=l.spaces.hwb.to.hsv(t);return l.spaces.hsv.to.hsl(e)}},parse(t,e=l.parseFunction(t)){if(e&&/^hwba?$/.test(e.name)){let t=e.args;return t[1]*=100,t[2]*=100,{spaceId:"hwb",coords:t.slice(0,3),alpha:t[3]}}},instance:{toString({format:t,commas:e,inGamut:s,...r}={}){return t||(t=(t,e)=>e>0?t+"%":t),l.prototype.toString.call(this,{inGamut:!0,commas:!1,format:t,name:"hwb",...r})}}}),l.defineSpace({id:"hsv",name:"HSV",coords:{hue:p,saturation:[0,100],value:[0,100]},inGamut(t){let e=this.to.hsl(t);return l.spaces.hsl.inGamut(e)},white:l.whites.D65,from:{hsl(t){let[e,s,r]=t;s/=100,r/=100;let a=r+s*Math.min(r,1-r);return[e,0===a?0:200*(1-r/a),100*a]}},to:{hsl(t){let[e,s,r]=t;s/=100,r/=100;let a=100*r*(1-s/2);return[e,0===a||1===a?0:(r-a)/Math.min(a,1-a),a]}}}),l.defineSpace({inherits:"srgb",id:"p3",name:"P3",cssId:"display-p3",toXYZ_M:[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],fromXYZ_M:[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]]}),l.defineSpace({inherits:"srgb",id:"a98rgb",name:"Adobe 98 RGB compatible",cssId:"a98-rgb",toLinear:t=>t.map((t=>Math.pow(Math.abs(t),563/256)*Math.sign(t))),toGamma:t=>t.map((t=>Math.pow(Math.abs(t),256/563)*Math.sign(t))),toXYZ_M:[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],fromXYZ_M:[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]]}),l.defineSpace({inherits:"srgb",id:"prophoto",name:"ProPhoto",cssId:"prophoto-rgb",white:l.whites.D50,toLinear:t=>t.map((function(t){return t<=.03125?t/16:Math.pow(t,1.8)})),toGamma:t=>t.map((function(t){return t>=.001953125?Math.pow(t,1/1.8):16*t})),toXYZ_M:[[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],fromXYZ_M:[[1.3457989731028281,-.25558010007997534,-.05110628506753401],[-.5446224939028347,1.5082327413132781,.02053603239147973],[0,0,1.2119675456389454]]}),l.defineSpace({inherits:"srgb",id:"rec2020",name:"REC.2020",α:1.09929682680944,β:.018053968510807,toLinear(t){const{α:e,β:s}=this;return t.map((function(t){return t<4.5*s?t/4.5:Math.pow((t+e-1)/e,2.4)}))},toGamma(t){const{α:e,β:s}=this;return t.map((function(t){return t>s?e*Math.pow(t,1/2.4)-(e-1):4.5*t}))},toXYZ_M:[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],fromXYZ_M:[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]]}),l.defineSpace({id:"absxyzd65",name:"Absolute XYZ D65",coords:{Xa:[0,9504.7],Ya:[0,1e4],Za:[0,10888.3]},white:l.whites.D65,Yw:203,inGamut:t=>!0,fromXYZ(t){const e=l.whites.D50,s=l.whites.D65;t=l.chromaticAdaptation(e,s,t);const{Yw:r}=this;return t.map((function(t){return Math.max(t*r,0)}))},toXYZ(t){const{Yw:e}=this;let s=t.map((function(t){return Math.max(t/e,0)}));const r=l.whites.D65,a=l.whites.D50;return l.chromaticAdaptation(r,a,s)}}),l.defineSpace({id:"jzazbz",cssid:"Jzazbz",name:"Jzazbz",coords:{Jz:[0,1],az:[-.5,.5],bz:[-.5,.5]},inGamut:t=>!0,white:l.whites.D65,b:1.15,g:.66,n:2610/16384,ninv:16384/2610,c1:.8359375,c2:2413/128,c3:18.6875,p:1.7*2523/32,pinv:32/(1.7*2523),d:-.56,d0:16295499532821565e-27,XYZtoCone_M:[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],ConetoXYZ_M:[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],ConetoIab_M:[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],IabtoCone_M:[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]],fromXYZ(e){const{b:s,g:r,n:a,p:o,c1:i,c2:n,c3:c,d:h,d0:p,XYZtoCone_M:d,ConetoIab_M:u}=this;let[m,g,f]=l.spaces.absxyzd65.fromXYZ(e),M=t(d,[s*m-(s-1)*f,r*g-(r-1)*m,f]).map((function(t){return((i+n*(t/1e4)**a)/(1+c*(t/1e4)**a))**o})),[b,w,y]=t(u,M);return[(1+h)*b/(1+h*b)-p,w,y]},toXYZ(e){const{b:s,g:r,ninv:a,pinv:o,c1:i,c2:n,c3:c,d:h,d0:p,ConetoXYZ_M:d,IabtoCone_M:u}=this;let[m,g,f]=e,M=t(u,[(m+p)/(1+h-h*(m+p)),g,f]).map((function(t){return 1e4*((i-t**o)/(c*t**o-n))**a})),[b,w,y]=t(d,M),S=(b+(s-1)*y)/s,C=(w+(r-1)*S)/r;return l.spaces.absxyzd65.toXYZ([S,C,y])},parse(t,e=l.parseFunction(t)){if(e&&"jzabz"===e.name)return{spaceId:"jzazbz",coords:e.args.slice(0,3),alpha:e.args.slice(3)[0]}},instance:{toString({format:t,...e}={}){return l.prototype.toString.call(this,{name:"jzazbz",format:t,...e})}}}),l.defineSpace({id:"jzczhz",name:"JzCzHz",coords:{Jz:[0,1],chroma:[0,1],hue:p},inGamut:t=>!0,white:l.D65,from:{jzazbz(t){let e,[s,r,a]=t;const o=5e-6;return e=Math.abs(r)<o&&Math.abs(a)<o?NaN:180*Math.atan2(a,r)/Math.PI,[s,Math.sqrt(r**2+a**2),d(e)]}},to:{jzazbz:t=>[t[0],t[1]*Math.cos(t[2]*Math.PI/180),t[1]*Math.sin(t[2]*Math.PI/180)]},parse(t,e=l.parseFunction(t)){if(e&&"jzczhz"===e.name)return e.args[0],{spaceId:"jzczhz",coords:e.args.slice(0,3),alpha:e.args.slice(3)[0]}}}),l.spaces.rec2020,l.defineSpace({id:"ictcp",name:"ICTCP",coords:{I:[0,1],CT:[-.5,.5],CP:[-.5,.5]},inGamut:t=>!0,white:l.whites.D65,c1:.8359375,c2:2413/128,c3:18.6875,m1:2610/16384,m2:2523/32,im1:16384/2610,im2:32/2523,XYZtoLMS_M:[[.3592,.6976,-.0358],[-.1922,1.1004,.0755],[.007,.0749,.8434]],Rec2020toLMS_M:[[1688/4096,2146/4096,262/4096],[683/4096,2951/4096,462/4096],[99/4096,309/4096,3688/4096]],LMStoIPT_M:[[.5,.5,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],IPTtoLMS_M:[[.9999888965628402,.008605050147287059,.11103437159861648],[1.00001110343716,-.008605050147287059,-.11103437159861648],[1.0000320633910054,.56004913547279,-.3206339100541203]],LMStoRec2020_M:[[3.437556893281401,-2.507211212509506,.06965431922810461],[-.7914286866564416,1.983837219874009,-.19240853321756743],[-.025646662911506475,-.09924024864394557,1.124886911555452]],LMStoXYZ_M:[[2.0701800566956137,-1.326456876103021,.20661600684785517],[.3649882500326575,.6804673628522352,-.04542175307585323],[-.04959554223893211,-.04942116118675749,1.1879959417328034]],fromXYZ(e){const{XYZtoLMS_M:s}=this;let[r,a,o]=l.spaces.absxyzd65.fromXYZ(e),i=t(s,[r,a,o]);return this.LMStoICtCp(i)},toXYZ(e){const{LMStoXYZ_M:s}=this;let r=t(s,this.ICtCptoLMS(e));return l.spaces.absxyzd65.toXYZ(r)},LMStoICtCp(e){const{LMStoIPT_M:s,c1:r,c2:a,c3:o,m1:i,m2:n}=this;return t(s,e.map((function(t){let e=r+a*(t/1e4)**i,s=1+o*(t/1e4)**i;return console.log({val:t,num:e,denom:s}),(e/s)**n})))},ICtCptoLMS(e){const{IPTtoLMS_M:s,c1:r,c2:a,c3:o,im1:i,im2:n}=this;return t(s,e).map((function(t){return 1e4*(Math.max(t**n-r,0)/(a-o*t**n))**i}))}});let u={range(...t){return l.range(this,...t)},mix(t,e=.5,r={}){"object"===s(e)&&([e,r]=[.5,e]);let{space:a,outputSpace:o}=r;return t=l.get(t),this.range(t,{space:a,outputSpace:o})(e)},steps(...t){return l.steps(this,...t)}};function m(t){return"function"===s(t)&&t.rangeArgs}function g(t,e,s){return isNaN(t)?e:isNaN(e)?t:t+(e-t)*s}l.steps=function(t,e,s={}){let r;m(t)&&([r,s]=[t,e],[t,e]=r.rangeArgs.colors);let{maxDeltaE:a,steps:o=2,maxSteps:i=1e3,...n}=s;r||(t=l.get(t),e=l.get(e),r=l.range(t,e,n));let c=this.deltaE(e),h=a>0?Math.max(o,Math.ceil(c/a)+1):o,p=[];if(void 0!==i&&(h=Math.min(h,i)),1===h)p=[{p:.5,color:r(.5)}];else{let t=1/(h-1);p=Array.from({length:h},((e,s)=>{let a=s*t;return{p:a,color:r(a)}}))}if(a>0){let t=p.reduce(((t,e,s)=>0===s?0:Math.max(t,e.color.deltaE(p[s-1].color))),0);for(;t>a;){t=0;for(let e=1;e<p.length&&p.length<i;e++){let s=p[e-1],a=p[e],o=(a.p+s.p)/2,i=r(o);t=Math.max(t,i.deltaE(s.color),i.deltaE(a.color)),p.splice(e,0,{p:o,color:r(o)}),e++}}}return p=p.map((t=>t.color)),p},l.range=function(t,e,s={}){if(m(t)){let[s,r]=[t,e];return l.range(...s.rangeArgs.colors,{...s.rangeArgs.options,...r})}let{space:r,outputSpace:a,progression:o,premultiplied:i}=s;t=new l(t),e=new l(e);let n={colors:[t,e],options:s};if(r=r?l.space(r):l.spaces[l.defaults.interpolationSpace]||t.space,a=a?l.space(a):t.space||r,t=t.to(r).toGamut(),e=e.to(r).toGamut(),r.coords.hue&&r.coords.hue.isAngle){let a=s.hue=s.hue||"shorter";[t[r.id].hue,e[r.id].hue]=function(t,e){if("raw"===t)return e;let[s,r]=e.map(d),a=r-s;return"increasing"===t?a<0&&(r+=360):"decreasing"===t?a>0&&(s+=360):"longer"===t?-180<a&&a<180&&(a>0?r+=360:s+=360):"shorter"===t&&(a>180?s+=360:a<-180&&(r+=360)),[s,r]}(a,[t[r.id].hue,e[r.id].hue])}return i&&(t.coords=t.coords.map((e=>e*t.alpha)),e.coords=e.coords.map((t=>t*e.alpha))),Object.assign((s=>{s=o?o(s):s;let n=t.coords.map(((t,r)=>g(t,e.coords[r],s))),c=g(t.alpha,e.alpha,s),h=new l(r,n,c);return i&&(h.coords=h.coords.map((t=>t/c))),a!==r&&(h=h.to(a)),h}),{rangeArgs:n})},Object.assign(l.defaults,{interpolationSpace:"lab"}),Object.assign(l.prototype,u),l.statify(Object.keys(u)),l.prototype.deltaECMC=function(t,{l:e=2,c:s=1}={}){let r=this;t=l.get(t);let[a,o,i]=r.lab,n=r.chroma,c=r.hue,[h,p,d]=t.lab,u=t.chroma;n<0&&(n=0),u<0&&(u=0);let m=a-h,g=n-u,f=o-p,M=i-d;const b=Math.PI/180;let w=f**2+M**2-g**2,y=.511;a>=16&&(y=.040975*a/(1+.01765*a));let S,C=.0638*n/(1+.0131*n)+.638;Number.isNaN(c)&&(c=0),S=c>=164&&c<=345?.56+Math.abs(.2*Math.cos((c+168)*b)):.36+Math.abs(.4*Math.cos((c+35)*b));let I=Math.pow(n,4),x=Math.sqrt(I/(I+1900)),z=(m/(e*y))**2;return z+=(g/(s*C))**2,z+=w/(C*(x*S+1-x))**2,Math.sqrt(z)},l.statify(["deltaECMC"]),l.prototype.deltaE2000=function(t,{kL:e=1,kC:s=1,kH:r=1}={}){t=l.get(t);let[a,o,i]=this.lab,n=this.chroma,[c,h,p]=t.lab,d=t.chroma;n<0&&(n=0),d<0&&(d=0);let u=(n+d)/2,m=Math.pow(u,7);const g=Math.pow(25,7);let f=.5*(1-Math.sqrt(m/(m+g))),M=(1+f)*o,b=(1+f)*h,w=Math.sqrt(M**2+i**2),y=Math.sqrt(b**2+p**2);const S=Math.PI,C=180/S,I=S/180;let x=0===M&&0===i?0:Math.atan2(i,M),z=0===b&&0===p?0:Math.atan2(p,b);x<0&&(x+=2*S),z<0&&(z+=2*S),x*=C,z*=C;let Y,j=c-a,P=y-w,E=z-x,X=x+z,Z=Math.abs(E);0==w&&0==y?Y=0:Z<=180?Y=E:E>180?Y=E-360:E<-180?Y=E+360:console.log("the unthinkable has happened");let N,_=2*Math.sqrt(y*w)*Math.sin(Y*I/2),A=(a+c)/2,G=(w+y)/2,v=Math.pow(G,7);N=0==w&&0==y?X:Z<=180?X/2:X<360?(X+360)/2:(X-360)/2;let L=(A-50)**2,D=1+.015*L/Math.sqrt(20+L),O=1+.045*G,k=1;k-=.17*Math.cos((N-30)*I),k+=.24*Math.cos(2*N*I),k+=.32*Math.cos((3*N+6)*I),k-=.2*Math.cos((4*N-63)*I);let $=1+.015*G*k,F=30*Math.exp(-1*((N-275)/25)**2),T=2*Math.sqrt(v/(v+g)),H=(j/(e*D))**2;return H+=(P/(s*O))**2,H+=(_/(r*$))**2,H+=-1*Math.sin(2*F*I)*T*(P/(s*O))*(_/(r*$)),Math.sqrt(H)},l.statify(["deltaE2000"]),l.prototype.deltaEJz=function(t){t=l.get(t);let[e,s,r]=this.jzczhz,[a,o,i]=t.jzczhz,n=e-a,c=s-o;Number.isNaN(r)&&Number.isNaN(i)?(r=0,i=0):Number.isNaN(r)?r=i:Number.isNaN(i)&&(i=r);let h=r-i,p=2*Math.sqrt(s*o)*Math.sin(h*Math.PI/180);return Math.sqrt(n**2+c**2+p**2)},l.statify(["deltaEJz"]),l.CATs={},l.hooks.add("chromatic-adaptation-start",(t=>{t.options.method&&(t.M=l.adapt(t.W1,t.W2,t.options.method))})),l.hooks.add("chromatic-adaptation-end",(t=>{t.M||(t.M=l.adapt(t.W1,t.W2,t.options.method))})),l.defineCAT=function({id:t,toCone_M:e,fromCone_M:s}){l.CATs[t]=arguments[0]},l.adapt=function(e,s,r="Bradford"){let a=l.CATs[r],[o,i,n]=t(a.toCone_M,e),[c,h,p]=t(a.toCone_M,s),d=t([[c/o,0,0],[0,h/i,0],[0,0,p/n]],a.toCone_M);return t(a.fromCone_M,d)},l.defineCAT({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599364,-1.1293816,.2198974],[.3611914,.6388125,-64e-7],[0,0,1.0890636]]}),l.defineCAT({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929,-.1470543,.1599627],[.4323053,.5183603,.0492912],[-.0085287,.0400428,.9684867]]}),l.defineCAT({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238,-.278869,.1827452],[.454369,.4735332,.0720978],[-.0096276,-.005698,1.0153256]]}),l.defineCAT({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.011254630531685,.1491867754444518],[.3875265432361372,.6214474419314753,-.008973985167612518],[-.01584149884933386,-.03412293802851557,1.04996443687785]]}),Object.assign(l.whites,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]});const f=l,M=new FastAverageColor;class b{constructor(t,e){this.position=t,this.image=e}getPosition(){return this.position}getImage(){return this.image}}const w=new class{constructor(){this.width=3,this.scale=50,this.height=500,this.element=document.querySelector("#canvas"),this.element.width=this.getWidth()*this.getScale(),this.element.height=this.getHeight()*this.getScale(),this.getContext().imageSmoothingEnabled=!1,this.images=[],this.listings=[],this.excluded=[],this.onLoad=()=>{}}addExclusion(t){return this.excluded.push(t),this}addExclusions(t){for(let e=0;e<t.length;e++)this.addExclusion(t[e]);return this}getExcluded(){return this.excluded}isExcluded(t){return this.getExcluded().includes(t)}interpolate(){let t=this.getListings().sort(((t,e)=>t.getPosition()>e.getPosition()?1:-1));if(t.length<=1)return;for(let e=1;e<t.length;e++){let s=t[e],r=t[e-1],a=new f(r.getImage().getHex()).steps(s.getImage().getHex(),{space:"lch",outputSpace:"srgb",steps:s.getPosition()-r.getPosition()});for(let t=0;t<s.getPosition()-r.getPosition();t++){if(!t){this.addPreview(r.getImage()).setIndex(r.getPosition(),r.getImage().getHex());continue}let e=this.getNearestImage(a[t].hex);this.addExclusion(e.getPath()).addPreview(e).setIndex(r.getPosition()+t,e.getHex())}}let e=t[t.length-1];this.addPreview(e.getImage()).setIndex(e.getPosition(),e.getImage().getHex())}getNearestImage(t){let e=9999.99,s=new y,r=new f(t),a=this.getImages();for(let t=0;t<a.length;t++){if(this.isExcluded(a[t].getPath()))continue;let o=new f(a[t].getHex()),i=r.deltaE(o,"76");i<e&&(e=i,s=a[t])}return s}setOnLoad(t){this.onLoad=t}addPreview(t){let e=document.querySelector("#images"),s=document.createElement("div");s.classList.add("container"),s.style=`background: ${t.getHex()}`;let r=document.createElement("img");r.src=t.getPath();let a=document.createElement("div");return a.appendChild(r),s.appendChild(a),e.prepend(s),this}update(){let t=this.getImages();if(!t.length)return this.onLoad();for(let e=0;e<t.length;e++)if(t[e].getLoading())return;return this.onLoad()}getImages(){return this.images}addImage(t){this.images.push(t)}getWidth(){return this.width}getHeight(){return this.height}getElement(){return this.element}getContext(){return this.getElement().getContext("2d")}getScale(){return this.scale}addListings(t){for(let e=0;e<t.length;e++)this.addListing(t[e]);return this}addListing(t){return this.addExclusion(t.getImage().getPath()),this.listings.push(t),this}setIndex(t,e){return this.setBlock(t%this.getWidth(),Math.floor(t/this.getWidth()),e)}setBlock(t,e,s){let r=this.getContext();return r.fillStyle=s,r.fillRect(t*this.getScale(),e*this.getScale(),this.getScale(),this.getScale()),this}getImageByPath(t){let e=this.getImages();for(let s=0;s<e.length;s++)if(e[s].getPath()===t)return e[s];return new y(0,0)}getListings(){return this.listings}};class y{constructor(t){if(this.path=t,this.color=[],this.isLoading=!1,!this.path)return;this.isLoading=!0;let e=document.createElement("img");e.src=this.path,e.style="display: none;",e.onload=()=>{M.getColorAsync(e).then((t=>w.addImage(this.setColor(t)))).catch((t=>{console.log(t)})),this.isLoading=!1,w.update()},document.body.appendChild(e),this.element=e}getHex(){return this.getColor().hex}getPath(){return this.path}getLoading(){return this.isLoading}getElement(){return this.element}getX(){return this.x}getY(){return this.y}setColor(t){return this.color=t,this}getColor(){return this.color}}w.setOnLoad((()=>{w.addExclusions(["./images/AAA036.jpg","./images/AAA016.jpg","./images/DSCF9275.jpg","./images/DSCF9498.jpg","./images/DSCF9303.jpg","./images/DSCF9071.jpg","./images/DSCF9318.jpg","./images/DSCF9368.jpg"]).addListings([new b(0,w.getImageByPath("./images/DSCF9369.jpg")),new b(10,w.getImageByPath("./images/DSCF9435.jpg")),new b(20,w.getImageByPath("./images/DSCF9500.jpg"))]).interpolate()})),fetch("/images.json").then((t=>t.json())).then((t=>{t.map((t=>{w.addImage(new y(`./images/${t}`))}))}))})();